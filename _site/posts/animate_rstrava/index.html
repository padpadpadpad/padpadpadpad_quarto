<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Daniel Padfield">
<meta name="dcterms.date" content="2018-05-18">
<meta name="description" content="Animate your Strava activities in R using rStrava and gganimate">

<title>DanPadLab - rStrava and gganimate</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">DanPadLab</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../software.html">
 <span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://scholar.google.co.uk/citations?user=1DXIqF4AAAAJ&amp;hl=en"><i class="bi bi-mortarboard-fill" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/padpadpadpad"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">rStrava and gganimate</h1>
                  <div>
        <div class="description">
          <p>Animate your Strava activities in R using rStrava and gganimate</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">R</div>
                <div class="quarto-category">strava</div>
                <div class="quarto-category">gganimate</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Daniel Padfield </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 18, 2018</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#getting-started-with-rstrava" id="toc-getting-started-with-rstrava" class="nav-link active" data-scroll-target="#getting-started-with-rstrava">Getting started with rStrava</a></li>
  <li><a href="#loading-packages-and-defining-tokens" id="toc-loading-packages-and-defining-tokens" class="nav-link" data-scroll-target="#loading-packages-and-defining-tokens">Loading packages and defining tokens</a></li>
  <li><a href="#download-your-data" id="toc-download-your-data" class="nav-link" data-scroll-target="#download-your-data">Download your data</a></li>
  <li><a href="#compile-your-data-into-tidy-dataframe" id="toc-compile-your-data-into-tidy-dataframe" class="nav-link" data-scroll-target="#compile-your-data-into-tidy-dataframe">Compile your data into “tidy” dataframe</a></li>
  <li><a href="#get-latitude-and-longitude-for-each-activity" id="toc-get-latitude-and-longitude-for-each-activity" class="nav-link" data-scroll-target="#get-latitude-and-longitude-for-each-activity">Get latitude and longitude for each activity</a></li>
  <li><a href="#create-a-gif-of-a-single-ride" id="toc-create-a-gif-of-a-single-ride" class="nav-link" data-scroll-target="#create-a-gif-of-a-single-ride">Create a gif of a single ride</a></li>
  <li><a href="#create-a-gif-of-all-the-rides" id="toc-create-a-gif-of-all-the-rides" class="nav-link" data-scroll-target="#create-a-gif-of-all-the-rides">Create a gif of ALL the rides</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="getting-started-with-rstrava" class="level2">
<h2 class="anchored" data-anchor-id="getting-started-with-rstrava">Getting started with rStrava</h2>
<p><strong>rStrava</strong> is an R package that allows you to access data from Strava using the Strava API. Some of the functions of <strong>rStrava</strong> scrape data from the public Strava website but to access your own data you will need a Strava profile and an authentication token. Details on obtaining your unique token can be found on the <a href="https://github.com/fawda123/rStrava"><strong>rStrava</strong></a> GitHub In addition to this key, we use <code>rgbif::elevation()</code> to calculate the elevation of each route. This requires a Google API key which can be created here.</p>
<p>Got a Strava authentication token? Got a Google API key? We are ready to create some animations! To create our animations, we use gganimate that requires ImageMagick to be installed.</p>
</section>
<section id="loading-packages-and-defining-tokens" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages-and-defining-tokens">Loading packages and defining tokens</h2>
<p>First load the packages that are used in the script and our Strava and Google authentication tokens. The <code>app_scope</code> argument in <code>strava_oauth()</code> has to be one of “read” , “read_all”, “profile:read_all”, “profile:write”, “activity:read”, “activity:read_all” or “activity:write”. To access your activities, <code>activity:read_all</code> has to be included.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages ####</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rStrava) <span class="co"># devtools::install_github('fawda123/rStrava')</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmap)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># initial setup ####</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Strava key</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>app_name <span class="ot">&lt;-</span> <span class="st">'xxxx'</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>app_client_id <span class="ot">&lt;-</span> <span class="st">'xxxxx'</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>app_secret <span class="ot">&lt;-</span> <span class="st">'"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"'</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create strava token</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>my_token <span class="ot">&lt;-</span> httr<span class="sc">::</span><span class="fu">config</span>(<span class="at">token =</span> <span class="fu">strava_oauth</span>(app_name, app_client_id, app_secret, <span class="at">app_scope =</span> <span class="st">'read_all,activity:read_all'</span>))</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Google elevation API key</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>GoogleAPI <span class="ot">&lt;-</span> <span class="st">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A browser window should open at this point saying Authentication complete. Please close this page and return to R. This means everything is going well!</p>
<div class="cell">

</div>
</section>
<section id="download-your-data" class="level2">
<h2 class="anchored" data-anchor-id="download-your-data">Download your data</h2>
<p>We can then download our personal activity data using the <code>rStrava::get_activity_list()</code>. This function needs your strava token and your strava athlete id. For example, my strava id is 2140248.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download strava data</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>my_acts <span class="ot">&lt;-</span> <span class="fu">get_activity_list</span>(my_token)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(my_acts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1669</code></pre>
</div>
</div>
<p>This returns a large list of all your previous activities. Mine has 1028 previous entries. If you want to explore your list, you can use <code>View(my_acts)</code> in RStudio which opens the Data Viewer window.</p>
</section>
<section id="compile-your-data-into-tidy-dataframe" class="level2">
<h2 class="anchored" data-anchor-id="compile-your-data-into-tidy-dataframe">Compile your data into “tidy” dataframe</h2>
<p><strong>rStrava</strong> has a function that compiles the information stored in the output of <code>get_activity_list()</code> to a “tidy” dataframe, with one row for each activity. <code>compile_activities()</code> finds all the columns across all activities and returns <code>NA</code> when a column is not present in a given activity. This means that if HR was not measured across all your strava activities, the function will still work!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compile activities into a tidy dataframe</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>my_acts <span class="ot">&lt;-</span> <span class="fu">compile_activities</span>(my_acts)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># have a look at the dataframe</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">glimpse</span>(my_acts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,669
Columns: 60
$ achievement_count             &lt;dbl&gt; 5, 9, 12, 0, 0, 1, 11, 1, 23, 3, 2, 0, 0…
$ athlete_count                 &lt;dbl&gt; 1, 1, 2, 1, 1, 1, 1, 1, 51, 1, 1, 1, 1, …
$ athlete.id                    &lt;chr&gt; "2140248", "2140248", "2140248", "214024…
$ athlete.resource_state        &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ average_heartrate             &lt;chr&gt; "127.8", "127.6", "123.8", NA, "127.4", …
$ average_speed                 &lt;dbl&gt; 21.9168, 26.2476, 24.0264, 27.1476, 17.5…
$ average_temp                  &lt;chr&gt; "10", "9", "9", "7", "3", NA, NA, NA, NA…
$ average_watts                 &lt;dbl&gt; 134.7, 156.7, 148.8, 101.1, 138.1, NA, N…
$ comment_count                 &lt;dbl&gt; 1, 14, 0, 0, 0, 3, 0, 0, 3, 0, 0, 0, 2, …
$ commute                       &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ device_watts                  &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ display_hide_heartrate_option &lt;chr&gt; "TRUE", "TRUE", "TRUE", "FALSE", "TRUE",…
$ distance                      &lt;dbl&gt; 22.3615, 27.7074, 42.3477, 5.7089, 5.639…
$ elapsed_time                  &lt;dbl&gt; 3822, 3884, 6656, 757, 1158, 1923, 4469,…
$ elev_high                     &lt;dbl&gt; 73.2, 146.2, 238.6, 118.2, 126.8, 75.9, …
$ elev_low                      &lt;dbl&gt; -0.4, 2.4, 4.6, 12.8, 20.0, 68.3, 45.1, …
$ end_latlng1                   &lt;dbl&gt; 50.15009, 50.00123, 50.15008, 50.15007, …
$ end_latlng2                   &lt;dbl&gt; -5.084491, -5.181100, -5.084519, -5.0845…
$ external_id                   &lt;chr&gt; "garmin_ping_260217768521", "garmin_ping…
$ flagged                       &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ from_accepted_tag             &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ gear_id                       &lt;chr&gt; "b11291030", "b11291030", "b11291030", "…
$ has_heartrate                 &lt;chr&gt; "TRUE", "TRUE", "TRUE", "FALSE", "TRUE",…
$ has_kudoed                    &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ heartrate_opt_out             &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ id                            &lt;dbl&gt; 8566326572, 8541744691, 8531882051, 8527…
$ kilojoules                    &lt;dbl&gt; 494.9, 595.4, 944.1, 76.5, 159.9, NA, NA…
$ kudos_count                   &lt;dbl&gt; 17, 23, 14, 5, 2, 8, 27, 5, 26, 4, 11, 1…
$ location_country              &lt;chr&gt; "United Kingdom", "United Kingdom", "Uni…
$ manual                        &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ map.id                        &lt;chr&gt; "a8566326572", "a8541744691", "a85318820…
$ map.resource_state            &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ map.summary_polyline          &lt;chr&gt; "a|aqHhu_^Uo@KmCOcAWo@kCwDYb@oBlEcDlC}D|…
$ max_heartrate                 &lt;chr&gt; "157", "150", "157", NA, "149", "166", "…
$ max_speed                     &lt;dbl&gt; 57.0096, 58.2696, 66.5136, 58.8420, 41.0…
$ moving_time                   &lt;dbl&gt; 3673, 3800, 6345, 757, 1158, 1878, 4314,…
$ name                          &lt;chr&gt; "Afternoon Ride", "Morning Ride. Fun unt…
$ photo_count                   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pr_count                      &lt;chr&gt; "0", "1", "8", "0", "0", "0", "7", "0", …
$ private                       &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ resource_state                &lt;dbl&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
$ sport_type                    &lt;chr&gt; "Ride", "Ride", "Ride", "Ride", "Ride", …
$ start_date                    &lt;chr&gt; "2023-02-15T16:04:05Z", "2023-02-11T10:0…
$ start_date_local              &lt;chr&gt; "2023-02-15T16:04:05Z", "2023-02-11T10:0…
$ start_latlng1                 &lt;dbl&gt; 50.15005, 50.15006, 50.14998, 50.17089, …
$ start_latlng2                 &lt;dbl&gt; -5.084534, -5.084494, -5.084516, -5.1274…
$ suffer_score                  &lt;chr&gt; "29", "30", "40", NA, "9", "33", "86", "…
$ timezone                      &lt;chr&gt; "(GMT+00:00) Europe/London", "(GMT+00:00…
$ total_elevation_gain          &lt;dbl&gt; 376.0, 372.0, 601.0, 38.0, 147.0, 15.0, …
$ total_photo_count             &lt;dbl&gt; 2, 3, 0, 0, 0, 0, 3, 0, 3, 0, 3, 0, 5, 3…
$ trainer                       &lt;chr&gt; "FALSE", "FALSE", "FALSE", "FALSE", "FAL…
$ type                          &lt;chr&gt; "Ride", "Ride", "Ride", "Ride", "Ride", …
$ upload_id                     &lt;chr&gt; "9196267205", "9168807862", "9157876592"…
$ upload_id_str                 &lt;chr&gt; "9196267205", "9168807862", "9157876592"…
$ utc_offset                    &lt;chr&gt; "0", "0", "0", "0", "0", "0", "0", "0", …
$ visibility                    &lt;chr&gt; "everyone", "everyone", "everyone", "eve…
$ workout_type                  &lt;chr&gt; "10", "10", NA, NA, NA, NA, "0", NA, "0"…
$ average_cadence               &lt;chr&gt; NA, NA, NA, NA, NA, "79.5", "81.3", "80.…
$ location_city                 &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
$ location_state                &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
</div>
</div>
<p>There are so many columns here, so I remove some columns I am not interested in for this post and do some data transformations to get the date in a correct format. I also do not want to run the example on all my rides, instead I filter them for just 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># columns to keep</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>desired_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'distance'</span>, <span class="st">'elapsed_time'</span>, <span class="st">'moving_time'</span>, <span class="st">'start_date'</span>, <span class="st">'start_date_local'</span>, <span class="st">'type'</span>, <span class="st">'map.summary_polyline'</span>, <span class="st">'location_city'</span>, <span class="st">'upload_id'</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># keep only desired columns</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>my_acts2 <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(my_acts, <span class="fu">any_of</span>(desired_columns))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># transformations ####</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>my_acts <span class="ot">&lt;-</span> <span class="fu">mutate</span>(my_acts,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">activity_no =</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">n</span>(), <span class="dv">1</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">elapsed_time =</span> elapsed_time<span class="sc">/</span><span class="dv">60</span><span class="sc">/</span><span class="dv">60</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">moving_time =</span> moving_time<span class="sc">/</span><span class="dv">60</span><span class="sc">/</span><span class="dv">60</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">date =</span> <span class="fu">gsub</span>(<span class="st">"T.*$"</span>, <span class="st">''</span>, start_date) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">as.POSIXct</span>(., <span class="at">format =</span> <span class="st">'%Y-%m-%d'</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">EUdate =</span> <span class="fu">format</span>(date, <span class="st">'%d/%m/%Y'</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">month =</span> <span class="fu">format</span>(date, <span class="st">"%m"</span>),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">day =</span> <span class="fu">format</span>(date, <span class="st">"%d"</span>),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">year =</span> <span class="fu">format</span>(date, <span class="st">"%Y"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="fu">across</span>(<span class="fu">c</span>(month, day), as.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.,year <span class="sc">==</span> <span class="st">'2020'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="get-latitude-and-longitude-for-each-activity" class="level2">
<h2 class="anchored" data-anchor-id="get-latitude-and-longitude-for-each-activity">Get latitude and longitude for each activity</h2>
<p>Each activity has a bunch of data associated with it. For mapping, I am interested in the <code>map.summary_polyline</code>, which is a Google polyline which allows the encoding of multiple latitude and longitude points as a single string. We can get the latitude and longitude for each of the activities by using <code>get_latlon()</code> which decodes the polylines and using dplyr and purrr to iterate over every activity in the dataframe. I add my Google API key as a column so that <code>map()</code> can easily find it.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get lat lon and distance of every ride ####</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>lat_lon <span class="ot">&lt;-</span> my_acts <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(map.summary_polyline)) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">'Ride'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">key =</span> GoogleAPI) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(activity_no) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coords =</span> <span class="fu">map</span>(data, <span class="sc">~</span><span class="fu">get_latlon</span>(.<span class="sc">$</span>map.summary_polyline, <span class="at">key =</span> .<span class="sc">$</span>key)),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist =</span> <span class="fu">map</span>(coords, <span class="sc">~</span><span class="fu">get_dists</span>(.x<span class="sc">$</span>lon, .x<span class="sc">$</span>lat))) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(., data) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(., <span class="fu">c</span>(coords, dist))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Having got the latitude and longitude for every ride, we can now get the elevation of each point and then calculate the gradient between points. To do this I use <code>elevation()</code> in the R package <strong>rgbif</strong>. To use this, you need to get a GeoNames username by registering for an account at <a href="http://www.geonames.org/login">http://www.geonames.org/login</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get elevation and calculate gradient between points</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>lat_lon <span class="ot">&lt;-</span> <span class="fu">ungroup</span>(lat_lon) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">ele =</span> rgbif<span class="sc">::</span><span class="fu">elevation</span>(<span class="at">latitude =</span> .<span class="sc">$</span>lat, <span class="at">longitude =</span> .<span class="sc">$</span>lon, <span class="at">user =</span> <span class="st">'YOUR USERNAME HERE'</span>, <span class="at">model =</span> <span class="st">'srtm1'</span>)<span class="sc">$</span>elevation_geonames)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>lat_lon <span class="ot">&lt;-</span> <span class="fu">group_by</span>(lat_lon, activity_no) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">ele_diff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(ele)),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist_diff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(dist)),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad =</span> <span class="fu">c</span>(<span class="dv">0</span>, (ele_diff[<span class="dv">2</span><span class="sc">:</span><span class="fu">n</span>()]<span class="sc">/</span><span class="dv">10</span>)<span class="sc">/</span>dist_diff[<span class="dv">2</span><span class="sc">:</span><span class="fu">n</span>()])) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(., <span class="sc">-</span><span class="fu">c</span>(ele_diff, dist_diff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>This now gives us a data frame of all my rides from 2020 with the latitude, longitude, cumulative distance, elevation and gradient. It would now be super easy to create elevation profiles, but I will save that for another post.</p>
</section>
<section id="create-a-gif-of-a-single-ride" class="level2">
<h2 class="anchored" data-anchor-id="create-a-gif-of-a-single-ride">Create a gif of a single ride</h2>
<p>We now have almost all the components to create a gif of a single ride.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>lat_lon_single <span class="ot">&lt;-</span> <span class="fu">filter</span>(lat_lon, activity_no <span class="sc">==</span> <span class="fu">min</span>(activity_no))</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(lat_lon_single)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 343</code></pre>
</div>
</div>
<p>However, Google polylines do not give a consistent number of latitude and longitude points. This means it might be hard to get a smooth elevation profile for the ride and also for smooth transitions in a gif. To create a set number of points from the current polyline, we can use geospatial packages such as <strong>sp</strong> and <strong>raster</strong> to interpolate a desired number of points from the current ones. Here I create 250 points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reorder columns so lat lon are first</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>lat_lon_single <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(lat_lon_single, lat, lon, <span class="fu">everything</span>())</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make new data with by interpolation</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>interp <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">spLines</span>(<span class="fu">as.matrix</span>(lat_lon_single[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  sp<span class="sc">::</span><span class="fu">spsample</span>(., <span class="at">n =</span> <span class="dv">250</span>, <span class="at">type =</span> <span class="st">'regular'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(., <span class="at">dist =</span> <span class="fu">get_dists</span>(lon, lat),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ele =</span> rgbif<span class="sc">::</span><span class="fu">elevation</span>(<span class="at">latitude =</span> .<span class="sc">$</span>lat, <span class="at">longitude =</span> .<span class="sc">$</span>lon, <span class="at">user =</span> <span class="st">'padpadpadpad'</span>, <span class="at">model =</span> <span class="st">'srtm1'</span>)<span class="sc">$</span>elevation_geoname,</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ele_diff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(ele)),</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist_diff =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">diff</span>(dist)),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">grad =</span> <span class="fu">c</span>(<span class="dv">0</span>, (ele_diff[<span class="dv">2</span><span class="sc">:</span><span class="fu">n</span>()]<span class="sc">/</span><span class="dv">10</span>)<span class="sc">/</span>dist_diff[<span class="dv">2</span><span class="sc">:</span><span class="fu">n</span>()]),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">n =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can now put the gif together, using <strong>ggmap</strong> and <strong>ggplot2</strong>. We use <strong>gganimate</strong> to make the plot animated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make bbox</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">make_bbox</span>(lon, lat, <span class="at">data =</span> lat_lon_single, <span class="at">f =</span> <span class="fl">1.3</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># download map</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">get_map</span>(<span class="at">location =</span> bbox, <span class="at">source =</span> <span class="st">'google'</span>, <span class="at">maptype =</span> <span class="st">'terrain'</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>single_ride <span class="ot">&lt;-</span> <span class="fu">ggmap</span>(map, <span class="at">darken =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat,  <span class="at">col =</span> grad, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">data =</span> interp, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="st">'Gradient (%)'</span>, <span class="at">palette =</span> <span class="st">'Spectral'</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">''</span>) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>() <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">theme_no_axes</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(dist)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># animate plot</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>gganimate<span class="sc">::</span><span class="fu">anim_save</span>(<span class="st">'where_to_save.gif'</span>, single_ride, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">700</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of this code can be seen below.</p>
<p><img src="../../posts/animate_rstrava/single_ride.gif" class="img-fluid"></p>
</section>
<section id="create-a-gif-of-all-the-rides" class="level2">
<h2 class="anchored" data-anchor-id="create-a-gif-of-all-the-rides">Create a gif of ALL the rides</h2>
<p>We can also make a gif of multiple activities. I will filter my activities to only be bike rides over 15km.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a bbox for Cornwall</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">make_bbox</span>(lat_lon_single<span class="sc">$</span>lon, lat_lon_single<span class="sc">$</span>lat, <span class="at">f =</span> <span class="fl">1.2</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add column for frame and total distance per ride</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>lat_lon <span class="ot">&lt;-</span> <span class="fu">group_by</span>(lat_lon, activity_no) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tot_dist =</span> <span class="fu">max</span>(distance)) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># filter lat_lon for when points are within this</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>lat_lon <span class="ot">&lt;-</span> <span class="fu">filter</span>(lat_lon, <span class="fu">between</span>(start_longitude, bbox[<span class="dv">1</span>], bbox[<span class="dv">3</span>]) <span class="sc">&amp;</span> <span class="fu">between</span>(start_latitude, bbox[<span class="dv">2</span>], bbox[<span class="dv">4</span>]) <span class="sc">&amp;</span> type <span class="sc">==</span> <span class="st">'Ride'</span> <span class="sc">&amp;</span> tot_dist <span class="sc">&gt;</span> <span class="dv">15</span>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add column for frame</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>lat_lon <span class="ot">&lt;-</span> <span class="fu">group_by</span>(lat_lon, activity_no) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="co"># make bbox again</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>bbox <span class="ot">&lt;-</span> ggmap<span class="sc">::</span><span class="fu">make_bbox</span>(lon, lat, <span class="at">data =</span> lat_lon, <span class="at">f =</span> <span class="fl">0.1</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># download map</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">get_map</span>(<span class="at">location =</span> bbox, <span class="at">source =</span> <span class="st">'google'</span>, <span class="at">maptype =</span> <span class="st">'terrain'</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>all_the_rides <span class="ot">&lt;-</span> <span class="fu">ggmap</span>(map, <span class="at">darken =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">group =</span> activity_no), <span class="at">col =</span> <span class="st">'red'</span>, <span class="at">data =</span> lat_lon, <span class="at">size =</span> <span class="fl">1.25</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'All the rides'</span>) <span class="sc">+</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>() <span class="sc">+</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>  ggforce<span class="sc">::</span><span class="fu">theme_no_axes</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'none'</span>) <span class="sc">+</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_reveal</span>(n)</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a><span class="co"># animate plot</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>gganimate<span class="sc">::</span><span class="fu">anim_save</span>(<span class="st">'where_to_save.gif'</span>, all_the_rides, <span class="at">width =</span> <span class="dv">750</span>, <span class="at">height =</span> <span class="dv">700</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="../../posts/animate_rstrava/all_the_rides.gif" class="img-fluid"></p>
<p>And there we have it. A relatively simple way to animate your strava activities in R. I personally find that saving the output as .mp4 rather than .gif gives smaller and higher quality files when uploading them to Instagram, but these options are easy to change. Take back your own data and get plotting!</p>
<p>There are loads of other functions and uses for the <strong>rStrava</strong> package. I hope to blog more about them soon.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="padpadpadpad/padpadpadpad_quarto" data-repo-id="R_kgDOI61nUg" data-category="General" data-category-id="DIC_kwDOI61nUs4CUFKs" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>